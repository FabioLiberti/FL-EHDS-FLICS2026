# SAL 26/02/2026 — v3

## Stato Avanzamento Lavori — FL-EHDS / FLICS2026

**Data:** 26 febbraio 2026, ore 11:40 CET
**Autore:** Fabio Liberti
**Versione precedente:** SAL_19022026_v2 (assessment paper)

---

## 1. Riepilogo Esecutivo

Dal SAL v2 (19/02) ad oggi sono stati compiuti progressi significativi:

- **75 nuovi esperimenti** imaging completati (seed expansion 3→5, 5 algoritmi aggiuntivi)
- **48/108 esperimenti DP imaging** completati, 60 rimanenti **in esecuzione su cloud GPU**
- **Paper e Supplementary aggiornati** con nuova tabella estesa e riferimenti
- **Fix tecnici critici** applicati (AMP su MPS, memory leak)
- **Infrastruttura cloud** configurata (RunPod A40 GPU) per accelerare il completamento
- Conteggio esperimenti totali: da 1,740+ a **1,815+** (diventerà ~1,923+ a completamento DP)

---

## 2. Esperimenti

### 2.1 Imaging Seeds 5 — Set A (COMPLETATO)

| Parametro | Valore |
|-----------|--------|
| **Stato** | **COMPLETATO** (75/75) |
| **Algoritmi** | FedAvg, FedLC, FedSAM, FedDecorr, FedExP |
| **Dataset** | Brain_Tumor, chest_xray, Skin_Cancer |
| **Seeds** | 42, 123, 456, 789, 999 |
| **Rounds** | 12, freeze_backbone=True, local_epochs=1 |
| **Checkpoint** | `paper_results/checkpoint_p12_multidataset.json` |

**Risultato chiave:** Tutti gli algoritmi non-personalizzati si raggruppano entro 6-9pp da FedAvg, confermando il finding principale del paper sulla superiorità degli approcci personalizzati (Ditto, HPFL).

**Integrazione nel paper:**
- Nuova tabella supplementare `tab:imaging_extended_algos`
- Paragrafo in Sezione IV con riferimento ai 75 esperimenti estesi
- Aggiornamento Discussion (V.B) e Limitations (V.E)

### 2.2 Imaging DP (Differential Privacy) — IN CORSO

| Parametro | Valore |
|-----------|--------|
| **Stato** | **IN CORSO** su RunPod A40 GPU |
| **Algoritmi** | FedAvg, Ditto, HPFL |
| **Dataset** | Brain_Tumor, chest_xray, Skin_Cancer |
| **DP Epsilon** | No-DP (baseline), 1, 5, 10 (clip_norm=1.0) |
| **Seeds** | 42, 123, 456 |
| **Config** | 20 rounds, local_epochs=2, FedBN, freeze_level=2 |
| **Totale** | 3 algos × 3 datasets × 4 eps × 3 seeds = **108 esperimenti** |
| **Checkpoint** | `paper_results_delta/checkpoint_imaging_dp.json` |

**Progresso dettagliato:**

| Dataset | Completati | Rimanenti | Note |
|---------|-----------|-----------|------|
| chest_xray | 33/36 | 3 | FedAvg noDP da ri-eseguire (bug fixato) |
| Brain_Tumor | 15/36 | 21 | FedAvg completo, Ditto parziale |
| Skin_Cancer | 0/36 | 36 | Non ancora iniziato |
| **Totale** | **48/108** | **60** | |

**Cronologia esecuzione:**
- 22-24/02: Esecuzione su Google Colab (T4 GPU) — 33 chest_xray completati
- 24-26/02: Trasferimento su Mac locale — 15 Brain_Tumor completati
- 26/02 ore 11:22: Trasferimento su **RunPod A40 GPU** — 60 rimanenti in corso
- **Stima completamento: 26/02 ore 17-18 CET**

**Velocità confronto:**

| Piattaforma | Tempo/round | Note |
|-------------|-------------|------|
| Mac M1 Pro (MPS off) | 7-40 min | Memory leak progressivo |
| Mac M1 Pro (post-fix) | 3-7 min | Dopo fix memory leak |
| RunPod A40 (CUDA+AMP) | ~2 min | **10-15x vs Mac pre-fix** |

### 2.3 Esperimenti Precedenti (COMPLETATI)

- **Tabular:** 5 datasets × 8+ algoritmi × 3 seeds × DP/noDP = completati
- **Imaging base:** 3 datasets × 4 algoritmi × 3 seeds = completati
- **Tabular DP:** completati
- **Totale precedente:** 1,740+ esperimenti

---

## 3. Paper — Stato Modifiche

### 3.1 File principale: `flics_fl_ehds_v2A.tex`

| Sezione | Modifica | Stato |
|---------|----------|-------|
| Abstract | Conteggio 1,740+ → 1,815+ | Applicato, non committato |
| Introduction | Conteggio aggiornato | Applicato, non committato |
| Section IV | Riferimento 75 esperimenti estesi + tabella | Applicato, non committato |
| Section V.B | Menzione 9-algorithm extended evaluation | Applicato, non committato |
| Section V.E | Updated limitations con extended evaluation | Applicato, non committato |

### 3.2 File supplementary: `flics_fl_ehds_supplementary_v2A.tex`

| Elemento | Descrizione | Stato |
|----------|-------------|-------|
| Nuova sezione | "Extended Algorithm Comparison on Imaging (5 Seeds)" | Applicato, non committato |
| Tabella `tab:imaging_extended_algos` | 5 algos × 3 datasets × 5 seeds | Applicato, non committato |
| 3 paragrafi analisi | Clustering, pattern matching, stabilità | Applicato, non committato |

### 3.3 Da fare dopo completamento DP imaging

- [ ] Nuova tabella DP imaging (privacy-utility tradeoff per dataset)
- [ ] Aggiornamento conteggio esperimenti (1,815+ → ~1,923+)
- [ ] Analisi cross-modale DP (tabular vs imaging)
- [ ] Paragrafo risultati DP in Sezione IV
- [ ] Assessment v2 completo del paper

---

## 4. Fix Tecnici

### 4.1 AMP fp16 su MPS — CRITICO

**File:** `terminal/training/federated_image.py:114`
**Problema:** AMP float16 è 4x più lento su Apple MPS (mancano tensor cores)
**Fix:** `self.use_amp = use_amp and self.device.type == 'cuda'`
**Impatto:** AMP abilitato solo su CUDA, disabilitato su MPS
**Stato:** Applicato, non committato

### 4.2 Memory Leak MPS — CRITICO

**File:** `benchmarks/run_imaging_dp.py:465, 619-628`
**Problema:** Trainer con tensori GPU non rilasciati tra esperimenti, rallentamento progressivo (da 15min a 168min per esperimento)
**Fix:** `del trainer` esplicito + `gc.collect()` + `torch.mps.empty_cache()` tra esperimenti
**Stato:** Applicato, non committato

### 4.3 FedLESAM Bug — IDENTIFICATO (non fixato)

**Scoperto in:** Set B (run_imaging_seeds5_local_backup.py)
**Problema:** FedLESAM produceva risultati identici a FedAvg (algoritmo non applicato)
**Impatto:** 3 entry nel checkpoint Set B invalide
**Stato:** Set B non usato nel paper; Set A usa algoritmi diversi (non include FedLESAM imaging)

---

## 5. Infrastruttura

### 5.1 Stato Corrente

| Risorsa | Stato | Dettagli |
|---------|-------|----------|
| **Mac locale** | Libero | Processo DP fermato, disponibile per lavoro |
| **RunPod A40** | **ATTIVO** | IP: 194.68.245.145:22174, $0.41/h |
| **AWS eu-north-1** | In attesa | Quota GPU richiesta, sotto review |
| **AWS us-east-1** | In attesa | Quota GPU CASE_OPENED |
| **Google Colab** | Non in uso | Disponibile come backup |

### 5.2 Costi

| Voce | Importo |
|------|---------|
| RunPod credito caricato | $30.00 |
| RunPod costo stimato (6-8h × $0.41) | ~$3-4 |
| RunPod credito residuo | ~$26-27 |
| AWS | $0 (nessuna istanza) |
| Google Colab | $0 (tier gratuito) |

### 5.3 Monitoraggio RunPod

```bash
# Output in tempo reale (dal web terminal RunPod)
tail -f /workspace/fl-ehds-framework/benchmarks/paper_results_delta/runpod_log.txt

# Conteggio esperimenti completati
python3 -c "import json; d=json.load(open('/workspace/fl-ehds-framework/benchmarks/paper_results_delta/checkpoint_imaging_dp.json')); ok=sum(1 for v in d['completed'].values() if 'error' not in v); print(f'{ok}/108 completati')"

# Da Mac via SSH
sshpass -p 'flehds2026' ssh root@194.68.245.145 -p 22174 'grep "Done:" /workspace/fl-ehds-framework/benchmarks/paper_results_delta/runpod_log.txt | wc -l'
```

---

## 6. Git — Stato Repository

**Branch:** main
**Ultimo commit:** `f3b4286` — "paper submit + supplementary material"

### Modifiche non committate:

| File | Tipo | Descrizione |
|------|------|-------------|
| `paper/paper2rel/flics_fl_ehds_v2A.tex` | Modificato | Conteggio + riferimenti estesi |
| `paper/paper2rel/flics_fl_ehds_supplementary_v2A.tex` | Modificato | Nuova tabella estesa + analisi |
| `fl-ehds-framework/terminal/training/federated_image.py` | Modificato | AMP fix per MPS |
| `fl-ehds-framework/benchmarks/run_imaging_dp.py` | Modificato | Memory leak fix |
| `fl-ehds-framework/benchmarks/aws_pack.sh` | Nuovo | Script packaging AWS |
| `fl-ehds-framework/benchmarks/aws_setup_and_run.sh` | Nuovo | Script setup EC2 |
| `fl-ehds-framework/benchmarks/aws_launch_when_ready.sh` | Nuovo | Script lancio automatico EC2 |

**Nota:** Il contributor "Claude" è stato rimosso dalla storia git con filter-branch + force push (sessione precedente).

---

## 7. Piano Azioni — Prossimi Passi

| # | Azione | Priorità | Quando | Stima | Dipendenze |
|---|--------|----------|--------|-------|------------|
| 1 | Completamento esperimenti DP su RunPod | CRITICO | Oggi 17-18h | Automatico | — |
| 2 | Download risultati DP da RunPod | CRITICO | Dopo #1 | 5 min | #1 |
| 3 | Terminare Pod RunPod (stop costi) | ALTO | Dopo #2 | 1 min | #2 |
| 4 | Integrare risultati DP nel paper + supplementary | CRITICO | Dopo #2 | 2h | #2 |
| 5 | Aggiornare conteggio esperimenti (~1,923+) | MEDIO | Con #4 | 15 min | #4 |
| 6 | Commit tutte le modifiche | ALTO | Dopo #4 | 10 min | #4 |
| 7 | Assessment v2 completo del paper | ALTO | Dopo #6 | 1h | #6 |
| 8 | Ruotare credenziali AWS | SICUREZZA | Appena possibile | 5 min | — |
| 9 | Cleanup risorse cloud (AWS SG, key pairs) | BASSO | Fine progetto | 15 min | — |

---

## 8. Rischi e Mitigazioni

| Rischio | Probabilità | Impatto | Mitigazione |
|---------|------------|---------|-------------|
| RunPod Pod si ferma/migra | Bassa | Medio | Checkpoint ogni round, resume automatico |
| Risultati DP imaging deludenti | Media | Basso | DP degradation è atteso, conferma pattern tabular |
| Credenziali AWS esposte | Alta (già avvenuto) | Alto | **Ruotare immediatamente** |
| Quota AWS non approvata | Media | Basso | RunPod come alternativa (già attivo) |

---

## 9. Metriche Chiave

| Metrica | Valore |
|---------|--------|
| Esperimenti completati | 1,863 / 1,923 target |
| Esperimenti in corso | 60 (su RunPod) |
| Paper aggiornato | Sì (non committato) |
| Assessment aggiornato | No (previsto dopo completamento DP) |
| Giorni dalla submission | 0 (pre-submission) |
| Budget cloud speso | ~$3-4 |
| Budget cloud rimanente | ~$26-27 (RunPod) |
